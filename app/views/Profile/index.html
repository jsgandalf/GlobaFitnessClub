#{extends 'main.html' /}
#{set title:'Profile' /}

#{set 'moreScripts'}
<!---CalendarEvent Plugin------------------>
    <script type='text/javascript' src="@{'/public/javascripts/fullcalendar/jquery-ui-1.8.21.custom.min.js'}"></script>
    <script type='text/javascript' src="@{'/public/javascripts/fullcalendar/fullcalendar.min.js'}"></script>
#{/set}
#{set 'moreStyles'}
    <link rel='stylesheet' type='text/css' href="@{'/public/javascripts/fullcalendar/cupertino/jquery-ui-1.8.21.custom.css'}" />
    <link rel='stylesheet' type='text/css' href="@{'/public/javascripts/fullcalendar/fullcalendar.css'}" />
    <link rel='stylesheet' type='text/css' href="@{'/public/javascripts/fullcalendar/fullcalendar.print.css'}" media='print' />
#{/set}

   <!--width="275" height="275"-->
    <div class="profile_banner">
        <div class="profile_banner_col1">
            <div id="helper"></div>
            <div class="left_pad">
                <h1>Profile Help</h1>
                <p>Welcome to Your fitness profile, click on the calendar to schedule and event with a trainer. Then edit your profile and track your goals</p>
            </div>
        </div>
        <div class="profile_banner_col2">
            <p class="pad_five">Maximize your efforts by completing your profile</p>
        </div>
    </div>
    <div class="ui-widget-content" style="moz-border-radius: 15px; border-radius: 15px; float:left; width:100%;">
        <div class="profile_left_col_container">
            <div class="profile_left_col">
                <a class="fancybox" href="${user.getProfilePic()}">
                    <img src="${user.getProfilePic()}" alt="Can't find user profile pic" />
                </a>
                <div class="clear"></div>
                <a href="@{Settings.index()}" style="float:left; color:#E9545A; margin-left: 13px;">Change Profile Pic</a>
            </div>
        </div>
        <div class="profile_mid_col">
            <table class="profile_table">
            <tr>
                <td colspan="2" style="padding-top:0px">
                    <h1>${user.fullName()} &nbsp;</h1>  <a style="font-size:12px; display:inline-block;" class="submit2" href="@{Settings.editProfile()}">Edit</a>
                </td>
            </tr>

            <tr>
                <td class="tableSubject">Location:</td>
                <td>${user.city}
                    #{if user.state},${user.state}#{/if}&nbsp;
                </td>
            </tr>

            <tr>
                <td class="tableSubject">Phone Number:</td>
                <td>${user.phoneNumber}&nbsp;</td>
            </tr>
            <tr>
                <td class="tableSubject">Email:</td>
                <td>${user.email}&nbsp;</td>
            </tr>
            <tr>
                <td class="tableSubject">Relationship status:</td>
                <td>${user?.relationship}&nbsp;</td>
            </tr>
            <tr>
                <td class="tableSubject">Fitness Goals:</td>
                <td>
                    #{list items:fitnessGoals, as:'goal'}
                        ${goal.name}${goal_isLast ? '' : ',' }
                    #{/list} &nbsp;
                </td>
            </tr>
            <tr>
                <td class="tableSubject ">Bio:</td>
                <td class="profile_description" colspan="2">
                ${user.bio}&nbsp;
                </td>
            </tr>
        </table>
        </div>
        <div class="profileRating">
            <div class="feedbackRatingHeader">
                <h2>Feedback</h2>
                <div class="feedBackNumber">
                    <h1>3.7</h1>
                    <div id="progressbar">
                    </div>
                    <a href="#">(7 Reviews)</a>
                </div>
            </div>
        </div>
    </div>
        <div class="clear"></div>
        <div class="shareDiv">
            <div class="shareLinks"><span class="grey bold">Share:</span> <a id="shareLink" class="commonLink upShareLink">Link</a> | <a id="sharePhoto" class="commonLink upShareLink">Photo</a> | <a id="shareVideo" class="commonLink upShareLink">Video</a></div>
            <input class="shareInput" type="text" size="16" value="I.e. Insanity workout 20 minutes!">
            <a id="shareButton" class="Button">Share</a>
        </div>
            <!--<div class="profile_table_border"></div>-->
            <div class="clear"></div>

            </div>
            <div id="createEvent" style="display:none">#{createEvent /}</div>
            <div id="editEvent" style="display:none">#{editEvent /}</div>
        <div class="clear"></div>

<div id="tabs" class="profle_tabs">
    <ul>
        <li><a href="#tabs-1">News Feed</a></li>
        <li><a href="#tabs-2" id="calendarTab">Calendar</a></li>
        <li><a href="#tabs-3">Workout Buddies</a></li>
    </ul>
    <div id="tabs-1">
        #{shareProfile shares:shares, user:user/}
    </div>
    <div id="tabs-2">
    </div>
    <div id="tabs-3">
        <p>You have no workout buddies yet, please add someone!</p>
        <p>This feature is comming soon to you!</p>
    </div>
</div>
<div style="display:none">
    <div id="dialog2" title="Loading">Loading</div>
    <div id="dialog3" title="Loading">Loading</div>
    <div id="loadingScreen"></div>
</div>
<script type='text/javascript'>


    $(function() {
        $("#progressbar").progressbar({
            value: 37
        });
        $( "#tabs" ).tabs();

        $('.Button').button();
    });
    $('.deleteShareDiv').hide();
$(document).ready(function() {
    $('#tabs-2').load("@{Profile.calendar}");
        //$('#calendarTab').click();
        //$(".fc-button-today").click();

    $('#calendarTab').click(function(){
        $(".fc-button-today").click();
    });

    initializeLoadingDialog();
    $('#shareLink').click(function(){
        $("#dialog2").html('<p>Share a Link on your news page! For example type:<br /> http://www.mysite.com</p><p><table class="shareTables"><tr><td>Link:</td><td><input class="shareInput" id="shareLinkInput" type="text" size="16" value=""></td></tr><tr><td>Message:</td><td><input class="shareInput" id="shareLinkInputContent" type="text" size="16" value=""></td></tr></table><p>');
        $("#dialog2").dialog({
            width: 400,
            title: "Share Link",
            buttons: [
                {
                    text: "Cancel",
                    click: function() { $(this).dialog("close"); }
                },
                {
                    text: "Share",
                    click: function() {
                        $.post('@{Profile.shareLink()}',{link:$('#shareLinkInput').val(), message:$('#shareLinkInputContent').val()},function(newShare){
                            $(this).dialog("close");
                            $.fancybox('<div style="height: 35px;width: 146px;margin: auto auto;"><h3 style="margin: 35px 10px;">Success!</h3></div>');

                            window.location.replace('@{Profile.index}');
                        });
                    }
                }
            ],
            open: function(event, ui) { $('#shareLinkInput').focus(); },
            modal: true
        })
    });
    $('#sharePhoto').click(function(){
        waitingDialog({});
        $("#dialog2").load("@{sharePhotoDiv}", function(){
            closeWaitingDialog();
            $("#dialog2").dialog({
               width: 600,
               title: "Share Photo",
               buttons: [
                    {
                        text: "Cancel",
                        click: function() { $(this).dialog("close"); }
                    }
               ],
               modal: true
            })
        });
    });
    $('#shareVideo').click(function(){
        var src = "@{'/public/images/youtube_help.jpg'}";
        $("#dialog2").html('<div style="display:inline-block; width:595px; margin: 0 auto;"><p>Share a Video on your news page from youtube! Simply click on the share button and copy and paste the link from the youtube video! Look at the example below.<br><br /><img src="'+src+'"></p><p><table class="shareTables"><tr><td>Link to this video:</td><td><input class="shareInput" id="shareVideoInput" style="width:307px" type="text" size="16" value=""></td></tr><tr><td>Message:</td><td><input style="width:307px" class="shareInput" id="shareVideoInputContent" type="text" size="16" value=""></td></tr></table><p></div>');
        $("#dialog2").dialog({
            width: 700,
            title: "Share Link",
            buttons: [
                {
                    text: "Cancel",
                    click: function() { $(this).dialog("close"); }
                },
                {
                    text: "Share",
                    click: function() {
                        $.post('@{Profile.shareVideo()}',{video:$('#shareVideoInput').val(), message:$('#shareVideoInputContent').val()},function(newShare){
                            $(this).dialog("close");
                            $.fancybox('<div style="height: 35px;width: 146px;margin: auto auto;"><h3 style="margin: 35px 10px;">Success!</h3></div>');

                            window.location.replace('@{Profile.index}');
                        });
                    }
                }
            ],
            open: function(event, ui) { $('#shareLinkInput').focus(); },
            modal: true
        })
    });

    $(".fancybox").fancybox();

    $('.shareInput').click(function(){
        $(this).val("");
        $(this).unbind();
    });

    $('.shareCommentButton').click(function(){
        waitingDialog({});
        var shareID = $(this).parent().parent().parent().parent().parent().parent().attr('shareID');
        $.post('@{Profile.addComment()}',{shareID:shareID,content:$('#myShareComment'+shareID).val()},function(newShare){
            closeWaitingDialog();
            $('#commentContainer'+shareID).append("<div class='picture_lists share_comment_list' id='comment"+newShare.id+"' commentid='"+newShare.id+"'><img class='commentThumbPic' src='${user.getProfileThumbPic()}' width='32' height='32'><div class='commentRightText'><span class='redText' style='margin-right:5px'>${user.fullName()}</span>"+newShare.content+"<div id='deleteComment"+newShare.id+"' class='deleteCommentDiv'><div class='deleteComment'></div></div><div class='commentDate'>a few seconds ago</div></div><div class='clear'></div></div>");
            $('.deleteCommentDiv').click(function(){
                var id = $(this).parent().parent().attr('commentid');
                $(this).unbind();
                $('#comment'+id).remove();
                $.post('@{Profile.deleteComment()}', {commentID: id}, function(deleteComment){
                    $('#comment'+id).remove();
                });
            });

            $('.picture_lists').hover(function(){
                $('#deleteComment'+$(this).attr('commentid')).show();
            },function(){
                $('.deleteCommentDiv').hide();
            });
            $('.myPictureComment').val("");
        },'json');
    });

    $('.shareCommentLink').click(function(){
        $(this).hide();
        $("#share_comments"+$(this).parent().parent().parent().parent().parent().attr('shareID')).show("slow");
    });

    $('.deleteCommentDiv').click(function(){
        waitingDialog({});
        var id = $(this).parent().parent().attr('commentid');
        $(this).unbind();
        $('#comment'+id).remove();
        $.post('@{Profile.deleteComment()}', {commentID: id}, function(deleteComment){
            $('#comment'+id).remove();
            closeWaitingDialog();
        });
    });

    $('.picture_lists').hover(function(){
        $('#deleteComment'+$(this).attr('commentid')).show();
    },function(){
        $('.deleteCommentDiv').hide();
    });

    $('#shareButton').click(function(){
        waitingDialog({});
        $.post('@{Profile.share()}',{content:$('.shareInput').val()},function(newShare){
            closeWaitingDialog();
            $.fancybox('<div style="height: 35px;width: 146px;margin: auto auto;"><h3 style="margin: 35px 10px;">Success!</h3></div>');

                window.location.replace('@{Profile.index}');

                //Ajax loading for later
                /*$('#tabs-1').append('<div class="newsComments" shareid="'+newShare.id+'" id="newsComments'+newShare.id+'"><div id="profile_thumb_container"><div class="newsCommentThumb"><img id="profile_thumb" class="picture_formating"  style="float:none;" src="${user?.getProfileThumbPic()}"><div class="commentDate shareCommentDate">a few seconds ago</div></div><div class="newsCommentContainer"><h2>${user?.fullName()}</h2><p  style="float:none;">'+newShare.content+'</p><span id="commentContainer'+newShare.id+'"></span><div id="newsCommentContainer'+newShare.id+'" style="width:100%"><p style="float:none;"><a class="shareCommentLink">Comment</a></p><div class="share_comments" id="share_comments'+newShare.id+'"><div><img width="32" height="32" class="picture_formating" src="${user.getProfileThumbPic()}"></div><div><input class="myPictureComment" id="myShareComment'+newShare.id+'" type="text"></div><div><a class="Button shareCommentButton">Comment</a></div></div></div></div><div class="deleteShareDiv" id="deleteShareDiv'+newShare.id+'"><div class="deleteComment"></div></div></div></div>')

                //For deleting a share
                $('#deleteShareDiv'+newShare.id).click(function(){
                    var id = $(this).parent().parent().attr('shareid');
                    $(this).unbind();
                    $('#newsComments'+id).remove();
                    $.post('@{Profile.deleteShare()}', {id: id}, function(data){
                        $('#newsComments'+id).remove();
                    });
                });

                $('#newsComments'+share.id).hover(function(){
                    $('#deleteShareDiv'+$(this).attr('shareid')).show();
                },function(){
                    $('.deleteShareDiv').hide();
                });

                //For adding a comment
                $('#newsCommentContainer'+share.id+' p a.shareCommentLink').click(function(){
                    $(this).hide();
                    $("#share_comments"+$(this).parent().parent().parent().parent().parent().attr('shareID')).show("slow");
                });

                $('#tabs-1').click();

                //For comments
                $('#share_comments'+share.id+' .shareCommentButton').click(function(){
                    var shareID = $(this).parent().parent().parent().parent().parent().parent().attr('shareID');
                    $.post('@{Profile.addComment()}',{shareID:shareID,content:$('#myShareComment'+shareID).val()},function(newShare){
                        $('#commentContainer'+shareID).append("<div class='picture_lists share_comment_list' id='comment"+newShare.id+"' commentid='"+newShare.id+"'><img class='commentThumbPic' src='${user.getProfileThumbPic()}' width='32' height='32'><div class='commentRightText'><span class='redText' style='margin-right:5px'>${user.fullName()}</span>"+newShare.content+"<div id='deleteComment"+newShare.id+"' class='deleteCommentDiv'><div class='deleteComment'></div></div><div class='commentDate'>a few seconds ago</div></div><div class='clear'></div></div>");
                        $('.deleteCommentDiv').click(function(){
                            var id = $(this).parent().parent().attr('commentid');
                        $(this).unbind();
                        $('#comment'+id).remove();
                        $.post('@{Profile.deleteComment()}', {commentID: id}, function(deleteComment){
                            $('#comment'+id).remove();
                        });
                    });

                $('.picture_lists').hover(function(){
                $('#deleteComment'+$(this).attr('commentid')).show();
                },function(){
                $('.deleteCommentDiv').hide();
                });
                },'json');
                });
                $('.Button').button();  */
        },'json');
    });

    $('.deleteShareDiv').click(function(){
        waitingDialog({});
        var id = $(this).parent().parent().attr('shareid');
        $(this).unbind();
        $('#newsComments'+id).remove();
        $.post('@{Profile.deleteShare()}', {id: id}, function(data){
            $('#newsComments'+id).remove();
            closeWaitingDialog();
        });
    });

    $('.newsComments').hover(function(){
        $('#deleteShareDiv'+$(this).attr('shareid')).show();
    },function(){
        $('.deleteShareDiv').hide();
    });


});

</script>